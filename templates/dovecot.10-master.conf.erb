## Dovecot configuration file
#
# This file is generated by Chef for <%= node['fqdn'] %>
#
# Local changes will be overwritten

service imap-login {

  inet_listener imap {
    port = 143
  }

  inet_listener imaps {
    port = 993
    ssl = yes
  }

  service_count = 0

}

service imap {

}

service lmtp {

  # On autorise Postfix à transférer les emails dans le spooler de Dovecot via LMTP
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
      mode = 0600
      user = <%= node['cmamail']['postfix']['user'] %>
      group = <%= node['cmamail']['postfix']['group'] %>
  }

}

service auth {

  # On autorise Postfix à se connecter à Dovecot via LMTP
  unix_listener /var/spool/postfix/private/auth {
      mode = 0666
      user =  <%= node['cmamail']['postfix']['user'] %>
      group =  <%= node['cmamail']['postfix']['group'] %>
  }

  # On indique à Dovecot les permissions du conteneur local
  unix_listener auth-userdb {
      mode = 0600
      user =  <%= node['cmamail']['vmail']['user'] %>
      group =  <%= node['cmamail']['vmail']['group'] %>
  }

  user = <%= node['cmamail']['dovecot']['user'] %>

}

service auth-worker {

  user =  <%= node['cmamail']['vmail']['user'] %>

}