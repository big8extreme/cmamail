## Dovecot configuration file
#
# This file is generated by Chef for <%= node['fqdn'] %>
#
# Local changes will be overwritten

protocols = imap lmtp
listen = *
log_timestamp = "%Y-%m-%d %H:%M:%S "
mail_location = maildir:/home/<%= node['cmamail']['dovecot']['user'] %>/%d/%n/Maildir
ssl_cert = <<%= node['cmamail']['sslFolder'] %>/dovecot.crt
ssl_key = <<%= node['cmamail']['sslFolder'] %>/dovecot.key

namespace {
    type = private
    separator = .
    prefix = INBOX.
    inbox = yes
}

service auth {
    unix_listener auth-master {
        mode = 0600
        user = <%= node['cmamail']['dovecot']['user'] %>

    }

    unix_listener /var/spool/postfix/private/auth {
        mode = 0666
        user = postfix
        group = postfix
    }

user = root
}

service auth-worker {
    user = root
}

protocol lda {
    log_path = /home/<%= node['cmamail']['dovecot']['user'] %>/dovecot-deliver.log
    auth_socket_path = /var/run/dovecot/auth-master
    postmaster_address = postmaster@example.com
}

protocol pop3 {
    pop3_uidl_format = %08Xu%08Xv
}

passdb {
    driver = sql
    args = <%= node['cmamail']['dovecot']['dovecot_root'] %>/dovecot-sql.conf.ext
}

userdb {
    driver = static
    args = uid=5000 gid=5000 home=/home/<%= node['cmamail']['dovecot']['user'] %>/%d/%n allow_all_users=yes
}